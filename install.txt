rBuilder Installation Instructions

    This document describes the steps necessary to install and configure
rBuilder.  You will be performing the following tasks:

    o Installing software

    o Configuring Postfix

    o Configuring Mailman

    o Configuring rBuilder

    o Testing and troubleshooting your rBuilder installation

Let's start by installing the necessary software.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
Software Installation
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

    In this section you'll be setting up an environment that supports
    rBuilder by performing the following tasks:

    o Installing rPath Linux

    o Erasing sendmail

    o Installing dnspython

    o Installing Postfix

    o Installing Mailman

    o Installing rBuilder (mint)

Before you begin, you'll need to identify the system which will be running
rBuilder.  Once your hardware is ready, perform the following steps:

    o Perform an "Everything" installation of rPath Linux

    o Erase Sendmail

        (conary erase sendmail)

    o Install dnspython from contrib.rpath.org@rpl:devel

        (conary update dnspython)

    o Install Postfix

        (conary update postfix)

    o Install Mailmain from contrib.rpath.org@rpl:noprivate

        (conary update mailman=:noprivate)

    o Install the main rBuilder trove (called "mint") provided by rPath

        (conary update mint)

NOTE: Further configuration may be required to ensure that postfix and
mailman can accept mail for the desired domain in your particular network
configuration.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
Postfix Configuration
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

    In this section, you'll be configuring Postfix to be integrated with
Mailman, and to run every time the system boots.  This requires the
following steps:

    o Edit /etc/postfix/main.cf and change the alias_maps line to read:

        alias_maps = hash:/etc/aliases, hash:/var/mailman/data/aliases
      
    o Ensure that tet the postfix service to start at boot

        (chkconfig postfix on)

    o Start the postfix service

        (/sbin/service postfix start)

NOTE: Further configuration may be required to ensure that postfix and
mailman can accept mail for the desired domain.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
Mailman Configuration
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

    In this section, you'll be configuring Mailman to correspond with your
system environment, and to run every time the system boots.  This requires
the following steps:

    o run (as root) /var/mailman/bin/mmsitepass to set a site password for mailman

# /var/mailman/bin/mmsitepass
New site password:
Again to confirm password:
Password changed.

      NOTE: Choose a password that is not used in any other context, as it
      will be stored -- in cleartext -- in a file readable by group apache!

    o Using the text editor of your choice, open
      /var/mailman/Mailman/mm_cfg.py, and review the following settings:

        - MTA (Must be set to "Postfix")
        - DEFAULT_URL_HOST (See below)
        - DEFAULT_EMAIL_HOST (See below)

      Both DEFAULT_URL_HOST and DEFAULT_EMAIL_HOST will default to the
      system's hostname (assuming reverse DNS lookups work properly at your
      site), but you can explicitly set them if required.

    o Run (as the mailman user) /var/mailman/bin/genaliases to regenerate
      Mailman-specific aliases; ignore any warning messages

# sudo -u mailman /var/mailman/bin/genaliases
postalias: warning: removing zero-length database file: /var/mailman/data/aliases.db

    o Run the following command (as the mailman user) to create the
      "mailman" list used to communicate with all Mailman list owners:

# sudo -u mailman /var/mailman/bin/newlist mailman
Enter the email of the person running the list: ed@rpath.com
Initial mailman password:
Hit enter to notify mailman owner...

      (NOTE: Choose a password that is not used in any other context, as it
      will appear -- in cleartext -- in the email messages Mailman sends
      to the list's owner)

    o chmod the aliases and aliases.db files in /var/mailman/data to mode 660

        (chmod 660 /var/mailman/data/aliases*)

    o Set the mailman service to start at boot

        (chkconfig mailman on)

    o Start the mailman service

        (/sbin/service mailman start)

      Once the list has been created (and Mailman started), Mailman will
      send out an email to the email address you specified.  If that
      address receives this email, your general Mailman and Postfix
      configuration is working properly.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
rBuilder Configuration
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

    In this section, you'll be configuring rBuilder to correspond with your
system environment.  This requires the following steps:

    o Perform the following commands:

# cd /srv/rbuilder
# cp rbuilder.conf.dist rbuilder.conf
# cp iso_gen.conf.dist iso_gen.conf
# cp installable_iso.conf.dist installable_iso.conf
# cp live_iso.conf.dist live_iso.conf

    o Edit /srv/rbuilder/iso_gen.conf and change serverUrl to reflect your
      site's hostname (Note that the username and password in this URL must
      reflect the username and password of an rBuilder account that you
      will be creating later in this document.)

    o Using the comments in rbuilder.conf as a guide, edit
      /srv/rbuilder/rbuilder.conf as appropriate for your site.

    o Copy /srv/authrepo/authrepo.cnr.dist to /srv/authrepo/authrepo.cnr:

# cd /srv/authrepo
# cp authrepo.cnr.dist authrepo.cnr

    o Edit authrepo.cnr and change serverName to reflect your site's
      hostname

    o Execute the following command as root:

# /usr/lib/python2.4/site-packages/conary/server/server.py --add-user <user> /srv/authrepo/repo/
Password: <password>
Reenter password: <password>

    (Where <user> and <password> is the same as the username and password
    reflected in the authRepoMap URL setting in /srv/rbuilder/rbuilder.conf.)

    o Issue the following commands:

# chgrp -R apache /srv/authrepo/repo/
# chmod -R g+w /srv/authrepo/repo/

    o If you want to address your projects' repositories as
      <hostname>.<domain-name>/repos/<project>, copy
      /etc/httpd/conf.d/rbuilder.conf.dist to /etc/httpd/conf.d/rbuilder.conf:

# cd /etc/httpd/conf.d
# cp rbuilder.conf.dist rbuilder.conf

    o If you want to address your projects' repositories using
      <project>.<domain-name>, perform the following steps:

        - Copy /etc/httpd/conf.d/rbuilder.conf.dist to
          /etc/httpd/conf.d/rbuilder.conf.last:

# cd /etc/httpd/conf.d
# cp rbuilder.conf.dist rbuilder.conf.last


        - Uncomment the following lines in
          /etc/httpd/conf.d/rbuilder.conf.last, and change ServerName to
          reflect your site's hostname:

            * ServerName
            * <VirtualHost *:80>
            * Alias /conary-static/
            * </VirtualHost>

      NOTE: This approach requires that apache already be configured for
      virtual hosting, and that a wildcard or other DNS arrangment has been
      configured.

    o Set the httpd service to start at boot

        (chkconfig httpd on)

    o Start the httpd service

        (/sbin/service httpd start)

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
Final Steps
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

    In this section, you'll be performing the final steps required to
complete the rBuilder installation.

    o Using the browser of your choice, open your rBuilder site's using the
      following URL:

http://<hostName>.<siteDomainName>/<basePath>/

      Or:

http://<hostName>.<siteDomainName>/ *** FIXME -- describe ***

      (Where <hostName>, <siteDomainName>, and <basePath> are the settings
      for the hostName, siteDomainName, and basePath configuration options
      specified in /srv/rbuilder/rbuilder.conf.)

    o Create an rBuilder account using the same name and password as
      referenced in the serverURL setting in /srv/rbuilder/iso_gen.conf.

      (NOTE: Make sure you have access to read email directed to the email
      address you provide, as you will receive a confirmation email from
      rBuilder.)

    o Once the confirmation email arrives, use the URL provided to activate
      this account.

    o Set the rbuilder-isogen service to start at boot:

        (chkconfig rbuilder-isogen on)

    o Start the rbuilder-isogen service using the following command:

# /sbin/service rbuilder-isogen start
