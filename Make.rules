#
# Copyright (c) 2005-2007 rPath, Inc.
#
# All Rights Reserved
#

PYTHON = $(shell [ -x /usr/bin/python2.4 ] && echo /usr/bin/python2.4 || echo /usr/lib/conary/python/bin/python2.4)
PYVERSION = $(shell $(PYTHON) -c 'import os, sys; print sys.version[:3]')
PYINCLUDE = $(shell $(PYTHON) -c 'import os, sys; print os.sep.join((sys.prefix, "include", "python" + sys.version[:3]))')
PYDIR = /usr/lib/python$(PYVERSION)/site-packages

## Default rules
default-install: install-subdirs

default-all: default-subdirs

default-clean: clean-subdirs
	rm -f *~ .#* *.pyo *.pyc *.orig *.o *.rej $(generated_files)

default-test:
	$(TESTSUITE) *.py


## Subdirectory rules
default-subdirs:
ifdef SUBDIRS
	for d in $(SUBDIRS); do make -C $$d DIR=$$d || exit 1; done
endif

clean-subdirs:
ifdef SUBDIRS
	for d in $(SUBDIRS); do make -C $$d DIR=$(DIR)/$$d clean || exit 1; done
endif

install-subdirs:
ifdef SUBDIRS
	for d in $(SUBDIRS); do make -C $$d DIR=$(DIR)/$$d \
		PYDEST=$(PYDEST)/$$d STATICDEST=$(STATICDEST)/$$d install || exit 1; done
endif

kid-build:
	for f in $(kid_files); do \
		kidc $$f; \
	done


raaplugins-install:
	for f in $(python_files); do \
		install -Dv -m0644 $$f $(DESTDIR)$(STATICDEST)/$$f; \
	done
	for f in $(kid_files); do \
		pyf=`echo $$f |sed -e s,\.kid$$,\.py,`; \
		install -Dv -m0644 $$f $(DESTDIR)$(STATICDEST)/$$f; \
		install -Dv -m0644 $$pyf $(DESTDIR)$(STATICDEST)/$$pyf; \
	done

pyfiles-install:
	for f in $(python_files); do \
		install -Dv -m0644 $$f $(DESTDIR)$(PYDIR)/$(PYDEST)/$$f; \
	done

kid-install:
	install -Dv -m0644 $(kid_files) $(DESTDIR)$(PYDIR)/$(PYDEST)/; \

static-install:
	for f in $(static_files); do \
		install -Dv -m0644 $$f $(DESTDIR)$(STATICDEST)/$$f; \
	done


kid-clean:
	for f in $(kid_files); do \
		pyf=`echo $$f |sed -e s,\.kid$$,\.py,`; \
		rm -f $$pyf; \
	done

# vim: set sts=8 sw=8 noexpandtab filetype=make :
