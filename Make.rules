#
# Copyright (c) 2005-2007 rPath, Inc.
#
# All Rights Reserved
#

.SILENT:

## Default rules
default-install: install-subdirs
	echo Installing in $(DIR)

default-all: default-subdirs
	echo Building in $(DIR)

default-clean: clean-subdirs
	rm -f *~ .#* .kiderror *.pyo *.pyc *.orig *.o *.rej $(generated_files)

default-test:
	$(TESTSUITE) *.py


## Subdirectory rules
default-subdirs:
ifdef SUBDIRS
	for d in $(SUBDIRS); do \
		make -C $$d DIR=$(DIR)/$$d || exit 1; \
	done
endif

clean-subdirs:
ifdef SUBDIRS
	for d in $(SUBDIRS); do make -C $$d DIR=$(DIR)/$$d clean || exit 1; done
endif

install-subdirs:
ifdef SUBDIRS
	for d in $(SUBDIRS); do \
		make -C $$d DIR=$(DIR)/$$d \
			PYDEST=$(PYDEST)/$$d STATICDEST=$(STATICDEST)/$$d \
			install || exit 1; \
	done
endif

kid-build:
	printf "%10s    %s\n" KIDC "$(kid_files)"
	kidc $(kid_files) 2>.kiderror || ( cat .kiderror; exit 1 )
	rm .kiderror

raaplugins-link:
ifdef SUBDIRS
	mkdir -p $(DESTDIR)$(LIBDIR)/raa/rPath
	for dir in $(SUBDIRS); do \
		ln -s ../../python$(PYVERSION)/site-packages/rPath/$$dir \
		      $(DESTDIR)$(LIBDIR)/raa/rPath/$$dir; \
	done
endif

raaplugins-unlink:
ifdef SUBDIRS
	for dir in $(SUBDIRS); do \
		rm -f $(DESTDIR)$(LIBDIR)/raa/rPath/$$dir; \
	done
endif
	rm -rf $(DESTDIR)$(LIBDIR)/raa

raaplugins-install:
	mkdir -p $(DESTDIR)$(STATICDEST)
ifdef python_files
	cp $(python_files) $(DESTDIR)$(STATICDEST)/
endif
ifdef kid_files
	cp $(kid_files) $(kid_files:%.kid=%.pyc) $(DESTDIR)$(STATICDEST)/
endif

pyfiles-install:
	mkdir -p $(DESTDIR)$(PYDIR)/$(PYDEST)
	cp $(python_files) $(DESTDIR)$(PYDIR)/$(PYDEST)/

kid-install:
	mkdir -p $(DESTDIR)$(PYDIR)/$(PYDEST)
	cp $(kid_files) $(kid_files:%.kid=%.pyc) $(DESTDIR)$(PYDIR)/$(PYDEST)/

static-install:
	mkdir -p $(DESTDIR)$(STATICDEST)
	cp $(static_files) $(DESTDIR)$(STATICDEST)/

cgi-install:
	mkdir -p $(DESTDIR)$(CGIDEST)
	cp $(cgi_files) $(DESTDIR)$(CGIDEST)/

kid-clean:

# vim: set sts=8 sw=8 noexpandtab filetype=make :
