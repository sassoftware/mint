#
# Copyright (c) 2005-2007 rPath, Inc.
#
# All Rights Reserved
#

PYTHON = $(shell [ -x /usr/bin/python2.4 ] && echo /usr/bin/python2.4 || echo /usr/lib/conary/python/bin/python2.4)
PYVERSION = $(shell $(PYTHON) -c 'import os, sys; print sys.version[:3]')
PYINCLUDE = $(shell $(PYTHON) -c 'import os, sys; print os.sep.join((sys.prefix, "include", "python" + sys.version[:3]))')
PYDIR = /usr/lib/python$(PYVERSION)/site-packages

## Default rules
default-install: install-subdirs

default-all: default-subdirs

default-clean: clean-subdirs
	rm -f *~ .#* *.pyo *.pyc *.orig *.o *.rej $(generated_files)

default-test:
	$(TESTSUITE) *.py


## Subdirectory rules
default-subdirs:
ifdef SUBDIRS
	for d in $(SUBDIRS); do make -C $$d DIR=$$d || exit 1; done
endif

clean-subdirs:
ifdef SUBDIRS
	for d in $(SUBDIRS); do make -C $$d DIR=$(DIR)/$$d clean || exit 1; done
endif

install-subdirs:
ifdef SUBDIRS
	for d in $(SUBDIRS); do make -C $$d DIR=$(DIR)/$$d \
		PYDEST=$(PYDEST)/$$d STATICDEST=$(STATICDEST)/$$d install || exit 1; done
endif

kid-build:
	kidc $(kid_files)


raaplugins-install:
	mkdir -p $(DESTDIR)$(STATICDEST)
ifdef python_files
	cp -v $(python_files) $(DESTDIR)$(STATICDEST)/
endif
ifdef kid_files
	cp -v $(kid_files) $(DESTDIR)$(STATICDEST)/
endif

pyfiles-install:
	mkdir -p $(DESTDIR)$(PYDIR)/$(PYDEST)
	cp -v $(python_files) $(DESTDIR)$(PYDIR)/$(PYDEST)/

kid-install:
	mkdir -p $(DESTDIR)$(PYDIR)/$(PYDEST)
	for kidfile in $(kid_files); do \
		pycfile=`echo $$kidfile | sed -e s,kid$$,pyc,` ; \
		cp -v $$kidfile $$pycfile $(DESTDIR)$(PYDIR)/$(PYDEST)/ ; \
	done

static-install:
	mkdir -p $(DESTDIR)$(STATICDEST)
	cp -v $(static_files) $(DESTDIR)$(STATICDEST)/


kid-clean:

# vim: set sts=8 sw=8 noexpandtab filetype=make :
